<%- include("../adminLayouts/header.ejs") %>

    <%- include("../adminLayouts/sidenavbar.ejs") %>
        <main class="main-wrap">
            <header class="main-header navbar">
                <div class="col-search">
                    <form class="searchform">
                        <div class="input-group">
                            <input list="search_terms" type="text" class="form-control" placeholder="Search term" />
                            <button class="btn btn-light bg" type="button"><i
                                    class="material-icons md-search"></i></button>
                        </div>
                        <datalist id="search_terms">
                            <option value="Products"></option>
                            <option value="New orders"></option>
                            <option value="Apple iphone"></option>
                            <option value="Ahmed Hassan"></option>
                        </datalist>
                    </form>
                </div>
                <div class="col-nav">
                    <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"><i
                            class="material-icons md-apps"></i></button>
                    <ul class="nav">
                        <li class="nav-item">
                            <a class="nav-link btn-icon" href="#">
                                <i class="material-icons md-notifications animation-shake"></i>
                                <span class="badge rounded-pill">3</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link btn-icon darkmode" href="#"> <i
                                    class="material-icons md-nights_stay"></i> </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="requestfullscreen nav-link btn-icon"><i
                                    class="material-icons md-cast"></i></a>
                        </li>
                        <li class="dropdown nav-item">
                            <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownLanguage"
                                aria-expanded="false"><i class="material-icons md-public"></i></a>
                            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownLanguage">
                                <a class="dropdown-item text-brand" href="#"><img
                                        src="admin_assets/imgs/theme/flag-us.png" alt="English" />English</a>
                                <a class="dropdown-item" href="#"><img src="admin_assets/imgs/theme/flag-fr.png"
                                        alt="Français" />Français</a>
                                <a class="dropdown-item" href="#"><img src="admin_assets/imgs/theme/flag-jp.png"
                                        alt="Français" />日本語</a>
                                <a class="dropdown-item" href="#"><img src="admin_assets/imgs/theme/flag-cn.png"
                                        alt="Français" />中国人</a>
                            </div>
                        </li>
                        <li class="dropdown nav-item">
                            <a class="dropdown-toggle" data-bs-toggle="dropdown" href="#" id="dropdownAccount"
                                aria-expanded="false"> <img class="img-xs rounded-circle"
                                    src="admin_assets/imgs/people/avatar-2.png" alt="User" /></a>
                            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">
                                <a class="dropdown-item" href="#"><i class="material-icons md-perm_identity"></i>Edit
                                    Profile</a>
                                <a class="dropdown-item" href="#"><i class="material-icons md-settings"></i>Account
                                    Settings</a>
                                <a class="dropdown-item" href="#"><i
                                        class="material-icons md-account_balance_wallet"></i>Wallet</a>
                                <a class="dropdown-item" href="#"><i class="material-icons md-receipt"></i>Billing</a>
                                <a class="dropdown-item" href="#"><i class="material-icons md-help_outline"></i>Help
                                    center</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item text-danger" href="#"><i
                                        class="material-icons md-exit_to_app"></i>Logout</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </header>
            <section class="content-main">
                <div class="content-header">
                    <div>
                        <h2 class="content-title card-title">Dashboard</h2>
                        <p>Whole data about your business here</p>
                    </div>
                    <div>
                        <a href="#" class="btn btn-primary"><i class="text-muted material-icons md-post_add"></i>Create
                            report</a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-3">
                        <div class="card card-body mb-4">
                            <article class="icontext">
                                <span class="icon icon-sm rounded-circle bg-primary-light"><i
                                        class="text-primary material-icons md-monetization_on"></i></span>
                                <div class="text">
                                    <h6 class="mb-1 card-title"> Sales count </h6>
                                    <span>
                                        <%= orderData.length %>
                                    </span>

                                </div>
                            </article>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="card card-body mb-4">
                            <article class="icontext">
                                <span class="icon icon-sm rounded-circle bg-success-light"><i
                                        class="text-success material-icons md-local_shipping"></i></span>
                                <div class="text">
                                    <h6 class="mb-1 card-title">Revenue</h6>
                                    <span>₹ <%= overolAmount %></span>

                                </div>
                            </article>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="card card-body mb-4">
                            <article class="icontext">
                                <span class="icon icon-sm rounded-circle bg-warning-light"><i
                                        class="text-warning material-icons md-qr_code"></i></span>
                                <div class="text">
                                    <h6 class="mb-1 card-title">Products count</h6>
                                    <span>
                                        <%= prodcutCount %>
                                    </span>

                                </div>
                            </article>
                        </div>
                    </div>

                </div>
                <div class="row">
                    <div class="col-xl-8 col-lg-12">
                        <div class="card mb-4">
                            <article class="card-body">

                                <select id="selectBox" style="width: 100px; height: 30px;">
                                    <option value="week">Week</option>
                                    <option value="month">Month</option>
                                    <option value="year">Year</option>


                                </select>
                                <canvas id="myChart" style="width:100%;max-width:700px"></canvas>
                            </article>
                        </div>


                    </div>


                </div>
                <div class="row">
                    <div class="col-xl-8 col-lg-12">
                        <div class="card mb-4">
                            <article class="card-body">
                                <canvas id="categoryChart" style="width:100%;max-width:700px"></canvas>
                            </article>
                        </div>
                    </div>
                </div>
                <div>
                    <div>
                        <h4>Best Selling Products</h4>

                        <div class="card-body">
                            <div class="row gx-3 row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-xl-4 row-cols-xxl-5">
                                <% if(topProducts.length> 0){ %>
                                    <% topProducts.forEach(item=>{ %>
                                        <div class="col">
                                            <div class="card card-product-grid">
                                                <a href="#" class="img-wrap"> <img src="<%= item.image[0] %>"
                                                        alt="Product" /> </a>
                                                <div class="info-wrap">
                                                    <a href="#" class="title text-truncate">
                                                        <%= item.pname %>
                                                    </a>
                                                    <div class="price mb-2">₹ <%= item.price %>
                                                    </div>


                                                </div>
                                            </div>
                                            <!-- card-product  end// -->
                                        </div>
                                        <% }) %>
                                            <% } %>
                            </div>
                        </div>



                    </div>


                </div>

                <div>
                    <div>
                        <h4>Best Selling Categories</h4>

                        <div class="card-body">
                            <div class="row gx-3 row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-xl-4 row-cols-xxl-5">
                                <% if(topCategories.length> 0){ %>
                                    <% topCategories.forEach(item=>{ %>
                                        <div class="col">
                                            <div class="card card-product-grid">
                                                <a href="#" class="img-wrap"> <img
                                                        src="/categoryimage/<%= item.image %>" alt="Product" /> </a>
                                                <div class="info-wrap">
                                                    <a href="#" class="title text-truncate">
                                                        <%= item.name %>
                                                    </a>
                                                </div>
                                            </div>
                                            <!-- card-product  end// -->
                                        </div>
                                        <% }) %>
                                            <% } %>
                            </div>
                        </div>


                    </div>


                </div>


               


            </section>


        </main>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
        <script src="/admin_assets/js/vendors/jquery-3.6.0.min.js"></script>
        <script src="/admin_assets/js/vendors/bootstrap.bundle.min.js"></script>
        <script src="/admin_assets/js/vendors/select2.min.js"></script>
        <script src="/admin_assets/js/vendors/perfect-scrollbar.js"></script>
        <script src="/admin_assets/js/vendors/jquery.fullscreen.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

        <!-- Main Script -->
        <script src="/admin_assets/js/main.js?v=1.1" type="text/javascript"></script>

        <script>
            document.getElementById('selectBox').addEventListener('change', function () {
                const timePeriod = this.value;

                var xValues, yValues;
                if (timePeriod == 'week') {
                    xValues = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"];
                    yValues = <%= JSON.stringify(week) %>;
                } else if (timePeriod == 'month') {
                    xValues = ["Week 1", "Week 2", "Week 3", "Week 4"];
                    yValues = <%= JSON.stringify(month) %>;
                } else {
                    xValues = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                    yValues = <%= JSON.stringify(year) %>;
                }

                updateChart(xValues, yValues);

                var chart;

                function updateChart(xValues, yValues) {
                    if (chart) {
                        chart.data.labels = xValues;
                        chart.data.datasets[0].data = yValues;
                        chart.update();
                    } else {
                        chart = new Chart("myChart", {
                            type: "bar",
                            data: {
                                labels: xValues,
                                datasets: [{
                                    backgroundColor: "blue",
                                    data: yValues
                                }]
                            },
                            options: {
                                legend: { display: false },
                                title: {
                                    display: true,
                                    text: "Sales Data"
                                }
                            }
                        });
                    }
                }

                updateChart(xValues, yValues);
            });

            document.getElementById('selectBox').dispatchEvent(new Event('change'));
        </script>

        
    <script>
        const categoryData = <%- JSON.stringify(categoryData) %>;

        const xValues = categoryData.map(category => category.name);
        const yValues = categoryData.map(category => category.count);

        let categoryChart;

        function updateCategoryChart(xValues, yValues) {
            if (categoryChart) {
                categoryChart.data.labels = xValues;
                categoryChart.data.datasets[0].data = yValues;
                categoryChart.update();
            } else {
                categoryChart = new Chart("categoryChart", {
                    type: "bar",
                    data: {
                        labels: xValues,
                        datasets: [{
                            backgroundColor: "red",
                            data: yValues
                        }]
                    },
                    options: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: "Category Sales Data"
                        }
                    }
                });
            }
        }

        updateCategoryChart(xValues, yValues);
    </script>


        <%- include("../adminLayouts/footer.ejs") %>